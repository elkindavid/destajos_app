{% extends 'base.html' %}
{% block title %}Registro de Destajos{% endblock %}
{% block content %}
<div x-data x-init="idbOpen()"> <!-- ðŸ‘ˆ abre IndexedDB al cargar -->
  <div x-data="destajosForm()" class="bg-white rounded-2xl shadow p-4">
    <h1 class="text-xl font-semibold mb-4">Nuevo registro</h1>
    <form @submit.prevent="submit()" class="grid md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm">Empleado (nombre)</label>
        <input x-model="empleado_nombre" @input.debounce.300="searchEmpleado()" @change="asignarDocumento()"  list="listaEmpleados" class="w-full border rounded p-2">
        <datalist id="listaEmpleados">
          <template x-for="(e, index) in empleados" :key="e.documento || index">
            <option :value="e.nombre"></option>
          </template>
        </datalist>
      </div>
      <div>
        <label class="block text-sm">Documento</label>
        <input x-model="empleado_documento" readonly class="w-full border rounded p-2  bg-gray-100">
      </div>
      <div>
        <label class="block text-sm">Destajo</label>
        <input x-model="destajo_text" @input.debounce.300="searchDestajo()" list="listaDestajos" class="w-full border rounded p-2">
        <datalist id="listaDestajos">
          <template x-for="d in destajos" :key="d.id">
            <option :value="d.concepto" x-text="d.concepto"></option>
          </template>
        </datalist>
      </div>
      <div>
        <label class="block text-sm">Cantidad</label>
        <input type="number" step="1" min="1" x-model.number="cantidad" class="w-full border rounded p-2">
      </div>
      <div>
        <label class="block text-sm">Fecha</label>
        <input type="date" x-model="fecha" class="w-full border rounded p-2">
      </div>
      <div class="flex items-end">
        <button class="px-4 py-2 bg-sky-600 text-white rounded">Guardar</button>
        <span class="ml-3 text-sm" x-text="status"></span>
      </div>
    </form>
  </div>
</div>
{% endblock %}
